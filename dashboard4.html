<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soft Analytics Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- CSS STYLES --- */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; transition: all 0.3s ease; }
        body { background-color: #f3f4f6; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }

        .dashboard-container {
            width: 100%; max-width: 750px; height: 500px;
            background: #f3f4f6; border-radius: 20px;
            padding: 25px; display: flex; flex-direction: column;
            position: relative;
        }

        .title { margin-bottom: 20px; font-weight: 700; color: #374151; font-size: 1.1rem; display: flex; justify-content: space-between; align-items: center; }
        .btn-refresh { cursor: pointer; color: #9ca3af; padding: 8px; border-radius: 50%; }
        .btn-refresh:hover { background: #e5e7eb; color: #374151; }

        /* Top Circles */
        .top-stats { display: flex; gap: 15px; margin-bottom: 20px; }
        .circle-card { 
            background: white; padding: 15px 10px; border-radius: 18px; flex: 1; 
            display: flex; flex-direction: column; align-items: center; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.02); 
            transform: translateY(0);
        }
        .circle-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0,0,0,0.05); }

        .circle-ring { 
            width: 55px; height: 55px; border-radius: 50%; border: 4px solid #f3f4f6; 
            display: flex; align-items: center; justify-content: center; 
            margin-bottom: 8px; color: #1f2937; font-weight: bold; font-size: 0.8rem; 
        }
        .label { font-size: 0.75rem; color: #6b7280; font-weight: 500; }

        /* Middle Section */
        .middle-section { display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; flex: 1; margin-bottom: 20px; }
        
        .pie-card { background: white; border-radius: 18px; padding: 20px; display: flex; align-items: center; justify-content: space-around; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        
        /* Pie Chart - Gradient handled by JS now */
        .pie-chart { 
            width: 120px; height: 120px; border-radius: 50%; 
            position: relative; 
            /* Initial State */
            background: conic-gradient(#f3f4f6 0% 100%);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .pie-chart:hover { transform: scale(1.05); }
        .pie-chart::after { content: ''; position: absolute; top: 22%; left: 22%; width: 56%; height: 56%; background: white; border-radius: 50%; box-shadow: inset 0 0 10px rgba(0,0,0,0.05); }
        
        .legend { display: flex; flex-direction: column; gap: 10px; font-size: 0.8rem; color: #4b5563; }
        .legend-item { cursor: pointer; padding: 4px 8px; border-radius: 6px; }
        .legend-item:hover { background: #f3f4f6; }
        .legend i { font-size: 0.6rem; margin-right: 6px; }

        .list-card { background: white; border-radius: 18px; padding: 20px; display: flex; flex-direction: column; justify-content: space-around; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .list-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: #4b5563; border-bottom: 1px solid #f3f4f6; padding-bottom: 5px; }
        .list-row:last-child { border-bottom: none; padding-bottom: 0; }
        .list-row strong { color: #111827; }

        /* Bottom Bar */
        .bottom-chart { 
            height: 80px; background: white; border-radius: 18px; padding: 15px 25px; 
            display: flex; align-items: flex-end; justify-content: space-between; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.02); 
        }
        .bar { 
            width: 12px; background: #e5e7eb; border-radius: 6px; 
            height: 0%; /* Start at 0 */
            transition: height 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .bar:hover { filter: brightness(0.9); }
        .bar.active { background: #8b5cf6; }
    </style>
</head>
<body>

    <div class="dashboard-container">
        <div class="title">
            <span>Fitness Analytics</span>
            <i class="fas fa-cog btn-refresh" id="btn-refresh" title="Generate New Data" onclick="refreshData()"></i>
        </div>
        
        <div class="top-stats">
            <div class="circle-card">
                <div class="circle-ring" style="border-color:#3b82f6;">
                    <span class="counter" data-target="{{ steps }}">0</span>
                </div>
                <span class="label">Steps</span>
            </div>
            <div class="circle-card">
                <div class="circle-ring" style="border-color:#f97316;">
                    <span class="counter" data-target="{{ cals }}">0</span>
                </div>
                <span class="label">Burner</span>
            </div>
            <div class="circle-card">
                <div class="circle-ring" style="border-color:#10b981;">
                    <span class="counter" data-target="{{ active }}">0</span>
                </div>
                <span class="label">Active</span>
            </div>
            <div class="circle-card">
                <div class="circle-ring" style="border-color:#8b5cf6;">
                    <span class="counter" data-target="{{ sleep }}">0</span>
                </div>
                <span class="label">Sleep</span>
            </div>
        </div>
        
        <div class="middle-section">
            <div class="pie-card">
                <div class="legend">
                    <div class="legend-item" onclick="highlightSlice(1)"><i class="fas fa-circle" style="color:#3b82f6"></i> Cardio</div>
                    <div class="legend-item" onclick="highlightSlice(2)"><i class="fas fa-circle" style="color:#ef4444"></i> Strength</div>
                    <div class="legend-item" onclick="highlightSlice(3)"><i class="fas fa-circle" style="color:#10b981"></i> Yoga</div>
                </div>
                <div class="pie-chart" id="pie-chart"></div>
            </div>
            <div class="list-card">
                <div class="list-row">
                    <span><i class="fas fa-heartbeat" style="color:#ef4444; width:20px;"></i> Heart Rate</span>
                    <strong id="val-hr">128 bpm</strong>
                </div>
                <div class="list-row">
                    <span><i class="fas fa-map-marker-alt" style="color:#3b82f6; width:20px;"></i> Distance</span>
                    <strong id="val-dist">6.4 km</strong>
                </div>
                <div class="list-row">
                    <span><i class="fas fa-weight" style="color:#6366f1; width:20px;"></i> Weight</span>
                    <strong id="val-wgt">161 lbs</strong>
                </div>
            </div>
        </div>
        
        <div class="bottom-chart" id="bar-chart-container">
            <div class="bar" data-height="30%"></div>
            <div class="bar" data-height="50%"></div>
            <div class="bar active" data-height="70%"></div>
            <div class="bar active" data-height="60%"></div>
            <div class="bar" data-height="40%"></div>
            <div class="bar" data-height="80%"></div>
            <div class="bar active" data-height="50%"></div>
            <div class="bar active" data-height="90%"></div>
            <div class="bar" data-height="45%"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initDashboard();
        });

        // Current Pie Data (Percentages)
        let pieData = {
            cardio: 50,    // Ends at 50%
            strength: 80,  // Ends at 80% (so size is 30%)
            yoga: 100      // Ends at 100% (so size is 20%)
        };

        function initDashboard() {
            animateCounters();
            animatePie();
            animateBars();
        }

        // 1. Counter Animation
        function animateCounters() {
            const counters = document.querySelectorAll('.counter');
            counters.forEach(counter => {
                const target = +counter.getAttribute('data-target');
                const start = 0;
                const duration = 1500;
                const startTime = performance.now();

                function update(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    // Ease out quart
                    const ease = 1 - Math.pow(1 - progress, 4);
                    
                    const current = Math.floor(start + (target - start) * ease);
                    
                    // Format K if large number
                    if(target > 9999) {
                         counter.innerText = (current / 1000).toFixed(1) + 'k';
                    } else {
                        counter.innerText = current;
                    }

                    if (progress < 1) requestAnimationFrame(update);
                    else if(target > 9999) counter.innerText = (target/1000).toFixed(0) + 'k'; // final fix
                }
                requestAnimationFrame(update);
            });
        }

        // 2. Pie Chart "Fan Out" Animation
        function animatePie() {
            const chart = document.getElementById('pie-chart');
            const duration = 1500;
            const startTime = performance.now();

            function updatePie(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const ease = 1 - Math.pow(1 - progress, 3); // Cubic ease out

                // Calculate stops based on progress multiplier
                // e.g., if progress is 0.5, stop 1 is at 25% instead of 50%
                const stop1 = pieData.cardio * ease;
                const stop2 = pieData.strength * ease;
                const stop3 = pieData.yoga * ease; // Should aim for 100% * ease

                // We need to keep the previous colors filling the space
                // Blue: 0 -> stop1
                // Red: stop1 -> stop2
                // Green: stop2 -> stop3
                // Transparent: stop3 -> 100%
                
                chart.style.background = `conic-gradient(
                    #3b82f6 0% ${stop1}%, 
                    #ef4444 ${stop1}% ${stop2}%, 
                    #10b981 ${stop2}% ${stop3}%, 
                    transparent ${stop3}% 100%
                )`;

                if (progress < 1) requestAnimationFrame(updatePie);
            }
            requestAnimationFrame(updatePie);
        }

        // 3. Bar Chart Growth
        function animateBars() {
            const bars = document.querySelectorAll('.bar');
            bars.forEach((bar, index) => {
                bar.style.height = '0%'; // Reset
                setTimeout(() => {
                    const target = bar.getAttribute('data-height');
                    bar.style.height = target;
                }, 100 + (index * 50)); // Stagger
            });
        }

        // 4. Highlight Logic (Simple visual feedback)
        function highlightSlice(index) {
            const chart = document.getElementById('pie-chart');
            // Quick pulse effect
            chart.style.transform = "scale(0.95)";
            setTimeout(() => chart.style.transform = "scale(1.05)", 150);
            setTimeout(() => chart.style.transform = "scale(1)", 300);
        }

        // 5. Refresh Data
        function refreshData() {
            const btn = document.getElementById('btn-refresh');
            btn.style.transform = "rotate(180deg)";
            setTimeout(() => btn.style.transform = "rotate(0deg)", 500);

            // Randomize Bar Data
            const bars = document.querySelectorAll('.bar');
            bars.forEach(bar => {
                const h = Math.floor(Math.random() * 80) + 15;
                bar.setAttribute('data-height', h + '%');
                // Randomly assign 'active' purple class
                if(Math.random() > 0.6) bar.classList.add('active');
                else bar.classList.remove('active');
            });

            // Randomize Stats
            const stepCounter = document.querySelector('.counter[data-target="11000"]');
            stepCounter.setAttribute('data-target', Math.floor(Math.random() * 5000) + 8000);

            // Randomize Pie Data slightly
            let r1 = Math.floor(Math.random() * 20) + 30; // 30-50
            let r2 = r1 + Math.floor(Math.random() * 20) + 20; // +20-40
            pieData = { cardio: r1, strength: r2, yoga: 100 };

            // Re-run animations
            initDashboard();
        }

    </script>
    <a href="/menu" style="position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.1); padding: 10px 15px; border-radius: 8px; text-decoration: none; color: inherit; font-weight: bold; font-family: sans-serif; z-index: 1000; backdrop-filter: blur(5px); display: flex; align-items: center; gap: 8px; transition: 0.2s;">
    <i class="fas fa-arrow-left"></i> Back
</a>

</body>
</html>